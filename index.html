<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Love Gun</title>
    <meta http-equiv="Content-Security-Policy" content="img-src 'self' data:; default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' https://www.googletagmanager.com; connect-src 'self' https://www.google-analytics.com; media-src 'self'">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <style>
        #intermission-video {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            max-width: 90%;
            max-height: 90%;
        }
        .small-header {
            font-size: 24px;
            text-align: center;
            margin-top: 20px;
        }
        .gun {
            font-family: monospace;
            transform-origin: center;
            transition: transform 0.1s ease;
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 24px;
            pointer-events: none;
            z-index: 1000;
        }
    </style>
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-9846PR9QGF"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-9846PR9QGF');
    </script>
</head>
<body>
    <div id="small-header" class="small-header">‚ñÑÔ∏ª„Éá‚ïê‚ïê‚Äê‰∏Ä‚ô°</div>
    
    <button id="play-pause-btn">‚è∏Ô∏è</button>
    <img id="home-button" src="images/home.gif" alt="Home" onclick="window.location.href='https://lovegun.xyz'">

    <audio id="background-music" src="NIGHTCORE Love Gun.mp3" loop></audio>
    <video id="intermission-video" src="images/intermission.mp4"></video>

    <div id="start-game-page">
        <select id="background-select"></select>
        <button onclick="startGame()">Start Game</button>
    </div>

    <div id="game" style="display: none;">
        <div id="score">Score: 000</div>
        <div id="level">Level: 1</div>
        <div id="timer">Time: 2:20</div>
        <div class="gun">‚ñÑÔ∏ª„Éá‚ïê‚ïê‚Äê‰∏Ä‚ô°</div>
    </div>

    <button id="play-next-level-btn" style="display: none;">Play Next Level</button>
    <button id="restart-button" style="display: none;">Play Again</button>
    <div id="notification"></div>
    <div id="level-progress">
        <div id="level-progress-bar"></div>
    </div>

<script>
    const backgroundMusic = document.getElementById('background-music');
    const playPauseBtn = document.getElementById('play-pause-btn');
    const playNextLevelBtn = document.getElementById("play-next-level-btn");
    const gameContainer = document.getElementById('game');
    const gun = document.querySelector('.gun');
    
    let level = 1;
    let score = 0;
    let gameTimer;
    let gameActive = false;
    let emojiFallInterval;
    const GAME_DURATION = 140; // 2 minutes and 20 seconds
    const MAX_LEVELS = 10;
    let totalScore = 0;

    const emojis = ['üòπ', 'üåΩ', 'ü§°', 'œáùêÉ', 'üçä', 'ü••üêï', 'üëë', 'üíúüéâ', 'üíâüß¨', 'üáπüáº', 'üê∂üî´', 'üéÄ', 'üåé‚òÆÔ∏è', 'üíú', 'ü¶çüçå', 'ü•©', 'üê∏', 'üî•', 'üé≤', 'üôÇ‚õìÔ∏è', 'üá∫üá∏', 'ü•®', 'üî®', 'üçÜ', 'üç£', 'ü™≤üßÉ', 'üß†ü§è ', 'üê°', 'üí∏', 'üê∑', 'üê§', 'üåï', 'ü™®', '‚úÇÔ∏è', 'üìÑ', '‚úâÔ∏è', 'ü¶ê', 'üá®üá≥', ' ‡§ú‡•Ä‡§§', 'ü•ß', 'üåÆ', 'üí©', 'üëΩ', 'üçâ', 'üçë', 'üöÄ', 'üíÄ'];
    let availableEmojis = [...emojis];

    function loadBackgroundOptions() {
        const backgrounds = [
            { name: 'Default (Pink)', url: '' },
            { name: 'ü§ç', url: 'images/bg1.png' },
            { name: 'L', url: 'images/bg2.png' },
            { name: 'O', url: 'images/bg3.png' },
            { name: 'V', url: 'images/bg4.png' },
            { name: 'E', url: 'images/bg5.png' },
            { name: 'ü§ç', url: 'images/bg6.png' },
            { name: 'G', url: 'images/bg7.png' },
            { name: 'U', url: 'images/bg8.png' },
            { name: 'N', url: 'images/bg9.png' },
            { name: 'ü§ç', url: 'images/bg10.png' },
            { name: 'Pew Pew', url: 'images/loveguns.gif' },
            { name: 'Matrix UwU', url: 'images/lovegunmatrix.gif' },
            { name: 'Do Not Click This UwU', url: 'images/epilepsyuwu.gif' }
        ];

        const selectBackground = document.getElementById('background-select');
        backgrounds.forEach(bg => {
            const option = document.createElement('option');
            option.value = bg.url;
            option.textContent = bg.name;
            selectBackground.appendChild(option);
        });
    }

    function startGame() {
        document.getElementById('start-game-page').style.display = 'none';
        document.getElementById('small-header').style.display = 'none';
        gameContainer.style.display = 'block';
        
        resetGame();
        startLevel();
        
        // Set cursor to crosshair
        document.body.style.cursor = `url('crosshair.png') 16 16, crosshair`;
    }

    function resetGame() {
    level = 1;
    score = 0;
    totalScore = 0;
    availableEmojis = [...emojis]; // Reset available emojis
    updateScoreDisplay();
    updateLevelDisplay();
    clearAllEmojis();
    }

    function startLevel() {
    gameActive = true;
    score = 0; // Only reset level score
    updateScoreDisplay();
    
    // Reset and start music
    backgroundMusic.currentTime = 0;
    backgroundMusic.play();
    
    // Start emoji spawning with level-appropriate speed
    startFallingEmojis();
    
    // Start game timer
    let timeLeft = GAME_DURATION;
    updateTimerDisplay(timeLeft);
    
    gameTimer = setInterval(() => {
        timeLeft--;
        updateTimerDisplay(timeLeft);
        
        if (timeLeft <= 0) {
            endLevel();
        }
    }, 1000);
    }

    function startFallingEmojis() {
        const baseSpeed = 2000; // Base spawn rate in milliseconds
        const levelSpeed = baseSpeed * (1 - (level - 1) * 0.1); // 10% faster each level
        
        emojiFallInterval = setInterval(() => {
            if (gameActive) {
                spawnEmoji();
            }
        }, levelSpeed);
    }

    function spawnEmoji() {
    // Refill and shuffle if we're out of emojis
    if (availableEmojis.length === 0) {
        availableEmojis = [...emojis];
        // Fisher-Yates shuffle
        for (let i = availableEmojis.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [availableEmojis[i], availableEmojis[j]] = [availableEmojis[j], availableEmojis[i]];
        }
    }
    
    // Take the next emoji from our shuffled array
    const emoji = document.createElement('div');
    emoji.className = 'falling-emoji';
    emoji.textContent = availableEmojis.pop(); // Remove and use last emoji from array
    emoji.style.left = `${Math.random() * (window.innerWidth - 50)}px`;
    emoji.style.top = '-50px';
    
    const fallSpeed = 5000 * (1 - (level - 1) * 0.1); // 10% faster each level
    emoji.style.animation = `fall ${fallSpeed}ms linear`;
    
    gameContainer.appendChild(emoji);
        
        emoji.addEventListener('click', () => {
            if (gameActive) {
                score++;
                updateScoreDisplay();
                emoji.remove();
            }
        });
        
        emoji.addEventListener('animationend', () => {
            emoji.remove();
        });
    }

    function updateGunPosition(e) {
        const gunRect = gun.getBoundingClientRect();
        const gunCenterX = gunRect.left + gunRect.width / 2;
        const gunCenterY = gunRect.top + gunRect.height / 2;
        
        // Calculate angle between gun and mouse
        const angle = Math.atan2(e.clientY - gunCenterY, e.clientX - gunCenterX);
        
        // Convert to degrees and rotate gun
        const degrees = angle * (180 / Math.PI);
        gun.style.transform = `rotate(${degrees}deg)`;
    }

    function endLevel() {
    gameActive = false;
    clearInterval(gameTimer);
    clearInterval(emojiFallInterval);
    clearAllEmojis();
    
    totalScore += score; // Add level score to total score
    
    if (level < MAX_LEVELS) {
        showNotification(`omg wow! ur love gunned down ${totalScore} memoji's UwU!`);
        playNextLevelBtn.style.display = 'block';
    } else {
        showNotification(`omg wow! ur love gunned down ${totalScore} memoji's UwU!\nGame Complete! üíï`);
        document.getElementById('restart-button').style.display = 'block';
    }
}

    function clearAllEmojis() {
        const emojis = document.querySelectorAll('.falling-emoji');
        emojis.forEach(emoji => emoji.remove());
    }

    function updateScoreDisplay() {
        document.getElementById('score').textContent = `Score: ${String(score).padStart(3, '0')}`;
    }

    function updateLevelDisplay() {
        document.getElementById('level').textContent = `Level: ${level}`;
    }

    function updateTimerDisplay(seconds) {
        const minutes = Math.floor(seconds / 60);
        const remainingSeconds = seconds % 60;
        document.getElementById('timer').textContent = 
            `Time: ${minutes}:${String(remainingSeconds).padStart(2, '0')}`;
    }

    function showNotification(message) {
        const notification = document.getElementById('notification');
        notification.textContent = message;
        notification.style.display = 'block';
    }

    playNextLevelBtn.addEventListener('click', () => {
        level++;
        playNextLevelBtn.style.display = 'none';
        document.getElementById('notification').style.display = 'none';
        startLevel();
    });

    playPauseBtn.addEventListener('click', () => {
        if (backgroundMusic.paused) {
            backgroundMusic.play();
            playPauseBtn.textContent = '‚è∏Ô∏è';
        } else {
            backgroundMusic.pause();
            playPauseBtn.textContent = '‚ñ∂Ô∏è';
        }
    });

    document.addEventListener('mousemove', updateGunPosition);
    loadBackgroundOptions();
</script>
</body>
</html>
